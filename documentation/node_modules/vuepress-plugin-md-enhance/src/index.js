"use strict";
const lineNumbers = require("@vuepress/markdown/lib/lineNumbers");
const flowchart_1 = require("./markdown-it/flowchart");
const footnote_1 = require("./markdown-it/footnote");
const katex_1 = require("./markdown-it/katex");
const pluginConfig_1 = require("./pluginConfig");
const path_1 = require("path");
const sub_1 = require("./markdown-it/sub");
const sup_1 = require("./markdown-it/sup");
module.exports = (option, context) => {
    const markdownOption = option === {} ? context.themeConfig.markdown || {} : option;
    const config = {
        name: 'md-enhance',
        enhanceAppFiles: path_1.resolve(__dirname, 'enhanceAppFile.ts'),
        /** Markdown 增强 */
        chainMarkdown: (md) => {
            //  添加行号
            if (markdownOption.lineNumbers !== false)
                md.plugin('line-numbers').use(lineNumbers);
            // 增加上角标
            if (markdownOption.sup || markdownOption.enableAll)
                md.plugin('sup').use(sup_1.default);
            // 增加下角标
            if (markdownOption.sub || markdownOption.enableAll)
                md.plugin('sub').use(sub_1.default);
            // 增加脚注
            if (markdownOption.footnote || markdownOption.enableAll)
                md.plugin('footnote').use(footnote_1.default);
            // 使用流程图;
            if (markdownOption.flowchart || markdownOption.enableAll)
                md.plugin('flowchart').use(flowchart_1.default);
            // 使用 tex;
            if (markdownOption.tex || markdownOption.enableAll)
                md.plugin('katex').use(katex_1.default, [
                    {
                        macros: {
                            // 支持更多积分符号
                            '\\liiiint': '\\int\\!\\!\\!\\iiint',
                            '\\iiiint': '\\int\\!\\!\\!\\!\\iiint',
                            '\\idotsint': '\\int\\!\\cdots\\!\\int'
                        }
                    }
                ]);
        }
    };
    /** 插件选项 */
    config.plugins = pluginConfig_1.default(markdownOption, context.themeConfig);
    return config;
};
